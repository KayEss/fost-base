import os ;
import path ;
include $(TOP)/../boost-version.jam ;
include $(TOP)/fost.jam ;
VERSION = [ os.environ VERSION ] ;

lib fost-core
    :
        ../../External//dload
        ../../External//uuid
        ../../../Boost//boost-date_time-dll
        ../../../Boost//boost-filesystem-dll
        ../../../Boost//boost-system-dll
        ../../../Boost//boost-thread-dll
        ../../../Boost//boost-regex-dll
        atexit.cpp
        base32.cpp
        coerce.cpp
        counter.cpp
        date.cpp
        dynlib.cpp
        exception.cpp
        file.cpp
        jcursor.cpp
        json.cpp
        json-coerce.cpp
        json-order.cpp
        json-parse.cpp
        json-unparse.cpp
        log.cpp
        log-global.cpp
        log-impl.cpp
        log-scoped.cpp
        meter.cpp
        module.cpp
        pool.cpp
        progress.cpp
        setting.cpp
        string.cpp
        string-ascii.cpp
        string-tagged.cpp
        string-utilities.cpp
        thread.cpp
        time.cpp
        timediff.cpp
        timestamp.cpp
        timestamp-rfc1123.cpp
        timezone.cpp
        unicode.cpp
        variant.cpp
        variant-coerce.cpp
        yaml.cpp
    :
        <include>../../../threading/include
        <include>../include
        <target-os>windows:<source>../../External//oleaut
        <tag>@fost-tag-output
        <version>$(VERSION)
        $(TARGET_REQUIREMENTS)
    ;

fost-smoke-test fost-core-unit-tests
    :
    :
        [ path.glob $(TOP)/Cpp/fost-core : *-tests.cpp *.tests.cpp ]
    ;


install fost-core-lib
    :
        fost-core
    :
        <location>$(PREFIX)/lib
        <target-os>linux:<install-type>LIB
        <target-os>linux:<install-dependencies>on
        <target-os>darwin:<install-type>LIB
        <target-os>darwin:<install-dependencies>on
        <target-os>windows:<install-type>XXX
    ;

install fost-core-exe
    :
        fost-core
    :
        <location>$(PREFIX)/bin
        <install-type>EXE
        <target-os>windows:<install-type>LIB
        <target-os>windows:<install-dependencies>on
    ;
